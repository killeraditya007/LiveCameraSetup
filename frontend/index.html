<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Room Camera Feed</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 1200px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        #videoFeed {
            width: 100%;
            height: auto;
            display: block;
            min-height: 400px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .status.online {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.offline {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.connecting {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .info-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .info-panel h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .info-panel p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Live Room Camera</h1>
            <p>Monitor your room from anywhere in the world</p>
        </div>

        <div id="status" class="status offline">
            Camera Offline
        </div>

        <div class="video-container">
            <img id="videoFeed" src="" alt="Live Camera Feed" style="display: none;">
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Connecting to camera...</p>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="startCamera()">Start Camera</button>
            <button class="btn btn-danger" onclick="stopCamera()">Stop Camera</button>
            <button class="btn btn-secondary" onclick="refreshFeed()">Refresh Feed</button>
        </div>

        <div class="info-panel">
            <h3>üì° Connection Information</h3>
            <p><strong>Server Status:</strong> <span id="serverStatus">Checking...</span></p>
            <p><strong>Camera Status:</strong> <span id="cameraStatus">Unknown</span></p>
            <p><strong>Last Updated:</strong> <span id="lastUpdated">Never</span></p>
            <p><strong>Instructions:</strong> Make sure the Python backend server is running on your laptop. The camera feed will be accessible from any device on the same network or over the internet if properly configured.</p>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let isStreaming = false;
        let statusCheckInterval;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkServerStatus();
            startStatusMonitoring();
        });

        async function checkServerStatus() {
            try {
                const response = await fetch(`${API_BASE}/`);
                const data = await response.json();
                document.getElementById('serverStatus').textContent = 'Online';
                document.getElementById('serverStatus').style.color = '#28a745';
                
                // Check camera status
                checkCameraStatus();
            } catch (error) {
                document.getElementById('serverStatus').textContent = 'Offline';
                document.getElementById('serverStatus').style.color = '#dc3545';
                updateStatus('offline', 'Server Offline');
            }
        }

        async function checkCameraStatus() {
            try {
                const response = await fetch(`${API_BASE}/camera_status`);
                const data = await response.json();
                
                document.getElementById('cameraStatus').textContent = data.is_streaming ? 'Active' : 'Inactive';
                document.getElementById('cameraStatus').style.color = data.is_streaming ? '#28a745' : '#dc3545';
                
                if (data.is_streaming && !isStreaming) {
                    startVideoFeed();
                } else if (!data.is_streaming && isStreaming) {
                    stopVideoFeed();
                }
            } catch (error) {
                document.getElementById('cameraStatus').textContent = 'Error';
                document.getElementById('cameraStatus').style.color = '#dc3545';
            }
        }

        function startStatusMonitoring() {
            statusCheckInterval = setInterval(() => {
                checkServerStatus();
                updateLastUpdated();
            }, 5000); // Check every 5 seconds
        }

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = now.toLocaleTimeString();
        }

        function updateStatus(status, message) {
            const statusElement = document.getElementById('status');
            statusElement.className = `status ${status}`;
            statusElement.textContent = message;
        }

        async function startCamera() {
            try {
                updateStatus('connecting', 'Starting Camera...');
                document.getElementById('loading').style.display = 'block';
                document.getElementById('videoFeed').style.display = 'none';

                const response = await fetch(`${API_BASE}/start_camera`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus('online', 'Camera Started');
                    setTimeout(() => {
                        startVideoFeed();
                    }, 1000);
                } else {
                    updateStatus('offline', 'Failed to Start Camera');
                    document.getElementById('loading').style.display = 'none';
                }
            } catch (error) {
                updateStatus('offline', 'Error Starting Camera');
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function stopCamera() {
            try {
                const response = await fetch(`${API_BASE}/stop_camera`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateStatus('offline', 'Camera Stopped');
                    stopVideoFeed();
                }
            } catch (error) {
                updateStatus('offline', 'Error Stopping Camera');
            }
        }

        function startVideoFeed() {
            const videoFeed = document.getElementById('videoFeed');
            const loading = document.getElementById('loading');
            
            videoFeed.src = `${API_BASE}/video_feed?t=${Date.now()}`;
            videoFeed.style.display = 'block';
            loading.style.display = 'none';
            isStreaming = true;
            updateStatus('online', 'Live Feed Active');
        }

        function stopVideoFeed() {
            const videoFeed = document.getElementById('videoFeed');
            videoFeed.src = '';
            videoFeed.style.display = 'none';
            isStreaming = false;
            updateStatus('offline', 'Camera Offline');
        }

        function refreshFeed() {
            if (isStreaming) {
                const videoFeed = document.getElementById('videoFeed');
                videoFeed.src = `${API_BASE}/video_feed?t=${Date.now()}`;
            }
        }

        // Handle video load errors
        document.getElementById('videoFeed').addEventListener('error', function() {
            updateStatus('offline', 'Video Feed Error');
            document.getElementById('loading').style.display = 'none';
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }
        });
    </script>
</body>
</html>
